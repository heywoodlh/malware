#!/usr/bin/env bash

[[ -n "$1" ]] && hostname="$1"
[[ -n "$2" ]] && port="$2"

## If no arguments are set, print usage
if [[ -z ${hostname} ]] && [[ -z ${port} ]]
then
    echo 'usage: ./build.sh [hostname] [port]'
## If arguments _are_ set, then build
else
    ## Create new file for build
    cp rev.nim rev_build.nim

    ## Replace values in build file
    sed -i "s/HOST/${hostname}/g" rev_build.nim
    sed -i "s/PORT/${port}/g" rev_build.nim

    ## Build for Windows
    nim compile -d:mingw -o:rev.exe rev_build.nim
    ## Build for MacOS
    nim compile --os:macos -o:rev-darwin.bin rev_build.nim
    ## Build for Linux
    nim compile -o:rev-linux.bin --os:linux rev_build.nim

    ## Cleanup rev_build.nim
    rm rev_build.nim
fi
